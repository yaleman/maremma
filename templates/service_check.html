{% extends "base_template.html" %}

{% block content %}

{% if let Some(message) = message %}
<div class="alert alert-{{ status }}" role="alert">
    {{ message }}
</div>
{% endif %}

<div class="container">
    <div class="row">
        <h1> Service Check: {{service_check.id}} </h1>
        {% if let Some(latest) = service_check_history.first() %}
        <h3>Last status: {{ latest.status }}</h3>
        {% endif %}

        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() {
                const form = document.getElementById('deleteCheck{{service_check.id}}');
                if (form) {
                    form.addEventListener('submit', function(event) {
                        event.preventDefault();
                        if (confirm('Are you sure you want to delete this check?')) {
                            this.submit();
                        }
                    });
                }
            });

        </script>
        <div style="float:right;">
            <form action="/service_check/{{service_check.id}}/urgent"
                method="post" class="buttonform">
                <input type="submit" class="btn btn-warning" value="Run ASAP" />
                <input type="hidden" name="redirect_to"
                    value="/service_check/{{service_check.id}}" />
            </form>

            <form
                action="/service_check/{{service_check.id}}/delete"
                id="deleteCheck{{service_check.id}}"
                method="post" class="buttonform">
                <input type="submit" class="btn btn-warning"
                    value="Delete This" />
                <input type="hidden" name="redirect_to"
                    value="/host/{{host.id}}" />
            </form></div>
        <p>
            <strong>Host:</strong> <a href="/host/{{host.id}}">{{ host.hostname
                }}</a><br />
            <strong>Service: </strong><a href="/service/{{service.id}}">{{
                service.name
                }}</a><br />
            {% if let Some(description) = service.description %}
            <strong>Description:</strong> {{ description }}<br />
            {% endif %}
            <strong>Type: </strong>{{service.service_type}}

            {% if let Some(config) = parsed_config %}
            <br /><button class="btn btn-secondary" type="button"
                data-bs-toggle="collapse" data-bs-target="#service_config"
                aria-expanded="false" aria-controls="service_config">
                Show Config
            </button>
            <div id="service_config"
                class="collapse"><pre><code>{{config}}</code></pre></div>

            {% endif %}
        </p>

        <table class="table table-striped caption-top">
            <caption>History (last {{ service_check_history.len() }}
                checks)</caption>
            <thead class="table-ligh">
                <th scope="col">Time</th>
                <th scope="col">Result</th>
                <th scope="col">Text</th>
            </thead>
            {% for entry in service_check_history %}
            <tr>
                <td>{{entry.timestamp}}</td>
                <td>{{entry.status}}</td>
                <td>{{entry.result_text}}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

</div>

{% endblock content %}
